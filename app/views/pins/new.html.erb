<% content_for :title, "New Pin" %>

<div class="flex justify-center items-start py-12">
  <div class="w-full max-w-xl bg-white p-8 rounded-xl shadow-md">
    
    <!-- Flash Messages -->
    <% if flash[:notice] %>
      <div class="mb-4 p-3 bg-green-100 text-green-700 rounded">
        <%= flash[:notice] %>
      </div>
    <% elsif flash[:alert] %>
      <div class="mb-4 p-3 bg-red-100 text-red-700 rounded">
        <%= flash[:alert] %>
      </div>
    <% end %>

    <h1 class="text-2xl font-bold text-center mb-6">Create a New Pin</h1>

    <%= form_with(
          model: @pin,
          local: true,
          data: { turbo: false },
          html: { multipart: true, class: "space-y-4" }
        ) do |f| %>

      <!-- Title -->
      <div>
        <%= f.label :title, class: "block mb-1 font-semibold" %>
        <%= f.text_field :title, class: "w-full border-gray-300 rounded p-2" %>
      </div>

      <!-- Description -->
      <div>
        <%= f.label :description, class: "block mb-1 font-semibold" %>
        <%= f.text_area :description, rows: 3, class: "w-full border-gray-300 rounded p-2" %>
      </div>

      <!-- FILE UPLOAD (Image or Video) -->
      <div>
        <%= f.label :file, "Upload Image or Video", class: "block mb-1 font-semibold" %>

        <%= f.file_field :file,
            accept: "image/png,image/jpeg,image/jpg,image/heif,image/heic,video/mp4,video/quicktime",
            class: "w-full text-gray-700" %>
      </div>

      <!-- TAG PEOPLE -->
      <div data-controller="tag-people" class="mb-6">
        <label class="block mb-2 font-semibold">Tag People</label>

        <!-- Search -->
        <input 
          type="text"
          placeholder="Search users..."
          class="border p-2 w-full rounded"
          data-tag-people-target="search"
          data-action="input->tag-people#search"
        >

        <!-- Search Results -->
        <div 
          data-tag-people-target="results"
          class="bg-white border rounded mt-2 hidden"
        ></div>

        <!-- Selected Users -->
        <div
          data-tag-people-target="selected"
          class="flex flex-wrap gap-2 mt-3"
        ></div>

        <!-- Hidden Inputs -->
        <div data-tag-people-target="hiddenFields"></div>
      </div>

      <!-- Submit Button -->
      <div class="text-center">
        <%= f.submit "Post Pin", class: "px-6 py-2 bg-red-600 text-white rounded-full hover:bg-red-700 transition" %>
      </div>

    <% end %>

    <!-- Back Link -->
    <div class="text-center mt-6">
      <%= link_to "Back to Pins", pins_path, class: "text-red-600 hover:underline" %>
    </div>
  </div>
</div>
