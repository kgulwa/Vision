<div class="border-l-2 border-gray-200 pl-4">
  <div class="flex justify-between items-start mb-2">
    <p class="text-sm">
      <% if comment.user.present? %>
        <strong><%= comment.user.username %>:</strong> <%= comment.content %>
      <% else %>
        <strong>Deleted User:</strong> <%= comment.content %>
      <% end %>
    </p>
    <% if current_user == comment.user %>
      <div class="flex space-x-2">
        <%= link_to "Edit", edit_pin_comment_path(comment.pin, comment), class: "text-blue-600 text-sm" %>
        <%= button_to "Delete", pin_comment_path(comment.pin, comment), method: :delete, data: { confirm: "Delete this comment?" }, class: "text-red-600 text-sm" %>
      </div>
    <% end %>
  </div>
  <%# Reply button and form %>
  <% if logged_in? %>
    <button
      onclick="document.getElementById('reply-form-<%= comment.id %>').classList.toggle('hidden')"
      class="text-blue-500 text-xs hover:underline mb-2"
    >
      Reply
    </button>
    <div id="reply-form-<%= comment.id %>" class="hidden mb-2">
      <%= form_with(model: [comment.pin, Comment.new], local: true, class: "space-y-2") do |f| %>
        <div>
          <%= f.text_area :content, placeholder: "Reply...", rows: 1,
            class: "w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
        </div>
        <%= f.hidden_field :parent_id, value: comment.id %>
        <%= f.submit "Post Reply",
          class: "px-3 py-1 bg-gray-200 rounded-md hover:bg-gray-300 text-sm" %>
      <% end %>
    </div>
  <% end %>
  <%# Render Replies â€” FIXED PATH %>
  <% comment.replies.where.not(user_uid: nil).order(created_at: :asc).each do |reply| %>
    <%= render partial: "pins/comment", locals: { comment: reply } %>
  <% end %>
</div>
