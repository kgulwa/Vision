<div class="w-full max-w-6xl mx-auto mt-6">

  <!-- USER INFO -->
  <div class="flex items-center space-x-4 mb-8">
    <div class="w-16 h-16 rounded-full bg-blue-500 text-white flex items-center justify-center text-2xl">
      <%= @user.username.first.upcase %>
    </div>
    <div>
      <h1 class="text-2xl font-bold"><%= @user.username %></h1>
      <p class="text-gray-500 text-sm">
        <%= pluralize(@user.pins.count, "pin") %>
      </p>
    </div>
  </div>

  <!-- FOLLOW BUTTON -->
  <% if logged_in? && current_user != @user %>
    <div class="mb-6">
      <% if current_user.following?(@user) %>
        <%= button_to user_follow_path(@user),
            method: :delete,
            class: "px-4 py-2 bg-red-100 text-red-600 rounded-full hover:bg-red-200" do %>
          Unfollow
        <% end %>
      <% else %>
        <%= button_to user_follow_path(@user),
            method: :post,
            class: "px-4 py-2 bg-blue-100 text-blue-600 rounded-full hover:bg-blue-200" do %>
          Follow
        <% end %>
      <% end %>
    </div>
  <% end %>

  <!-- TWO-COLUMN GRID: PINS | REPOSTS -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

    <!-- USER'S PINS -->
    <div>
      <h2 class="text-xl font-semibold mb-4">Pins</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
        <% @user.pins.each do |pin| %>
          <div class="bg-white rounded-lg shadow-md overflow-hidden relative">
            <% if pin.image.attached? %>
              <%= link_to image_tag(pin.image, class: "w-full h-48 object-cover"), pin_path(pin) %>
            <% end %>
            <div class="p-4">
              <h3 class="font-semibold text-lg mb-2"><%= link_to pin.title, pin_path(pin) %></h3>
              <% if pin.description.present? %>
                <p class="text-gray-700 text-sm mb-2"><%= truncate(pin.description, length: 80) %></p>
              <% end %>

              <!-- Edit/Delete buttons for current user's pins -->
              <% if current_user == @user %>
                <div class="flex space-x-2 mt-2">
                  <%= link_to "Edit", edit_pin_path(pin), class: "px-2 py-1 bg-blue-100 text-blue-600 rounded hover:bg-blue-200 text-sm" %>
                  <%= button_to "Delete", pin_path(pin), method: :delete, data: { confirm: "Are you sure?" }, class: "px-2 py-1 bg-red-100 text-red-600 rounded hover:bg-red-200 text-sm" %>
                </div>
              <% end %>
            </div>

            <!-- Comments -->
            <div class="p-4 border-t">
              <h4 class="font-semibold text-sm mb-2">Comments</h4>
              <% pin.comments.each do |comment| %>
                <div class="flex justify-between items-start mb-2">
                  <p class="text-sm"><strong><%= comment.user.username %>:</strong> <%= comment.body %></p>
                  <% if current_user == comment.user %>
                    <div class="flex space-x-2">
                      <%= link_to "Edit", edit_pin_comment_path(pin, comment), class: "text-blue-600 text-sm" %>
                      <%= button_to "Delete", pin_comment_path(pin, comment), method: :delete, data: { confirm: "Delete this comment?" }, class: "text-red-600 text-sm" %>
                    </div>
                  <% end %>
                </div>
              <% end %>
            </div>

          </div>
        <% end %>
      </div>
      <% if @user.pins.empty? %>
        <p class="text-gray-500 mt-4">This user hasn’t posted any pins yet.</p>
      <% end %>
    </div>

    <!-- USER'S REPOSTS -->
    <div>
      <h2 class="text-xl font-semibold mb-4">Reposts</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
        <% @user.reposts.each do |repost| %>
          <% pin = repost.pin %>
          <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <% if pin.image.attached? %>
              <%= link_to image_tag(pin.image, class: "w-full h-48 object-cover"), pin_path(pin) %>
            <% end %>
            <div class="p-4">
              <h3 class="font-semibold text-lg mb-2"><%= link_to pin.title, pin_path(pin) %></h3>
              <% if pin.description.present? %>
                <p class="text-gray-700 text-sm mb-2"><%= truncate(pin.description, length: 80) %></p>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
      <% if @user.reposts.empty? %>
        <p class="text-gray-500 mt-4">This user hasn’t reposted any pins yet.</p>
      <% end %>
    </div>

  </div>
</div>
